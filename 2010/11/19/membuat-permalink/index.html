<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=HandheldFriendly content=True><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Membuat Permalink"><meta name=keywords content=Database,PHP><meta property=og:type content=article><meta property=og:title content="Membuat Permalink"><meta property=og:url content=http://arie.malam.or.id/2010/11/19/membuat-permalink/index.html><meta property=og:site_name content="Log Channel"><meta property=og:description content="Membuat Permalink"><meta property=og:updated_time content=2017-05-20T09:20:43.359Z><meta name=twitter:card content=summary><meta name=twitter:title content="Membuat Permalink"><meta name=twitter:description content="Membuat Permalink"><link rel="shortcut icon" href=/favicon.ico><link rel=icon type=image/png href=/images/favicon-192x192.png sizes=192x192><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><title>Membuat Permalink</title><link rel=stylesheet href=/css/style.css></head><body><div id=header-post><a id=menu-icon href=#><i class="fa fa-bars fa-lg"></i> </a><a id=menu-icon-tablet href=#><i class="fa fa-bars fa-lg"></i> </a><a id=top-icon-tablet href=# onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style=display:none><i class="fa fa-chevron-up fa-lg"></i> </a><span id=menu><span id=nav><ul><li><a href=/ >Home</a></li><li><a href=/archives/ >Blog</a></li><li><a href=/about/ >About</a></li><li><a href=/contact/ >Contact</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=/2010/11/23/membuat-permalink-otomatis-dengan-jelly/ ><i class="fa fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class=icon href=/2010/11/14/relation-has-one-dengan-jelly-orm/ ><i class="fa fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class=icon href=#><i class="fa fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span> <span id=i-next class=info style=display:none>Next post</span> <span id=i-top class=info style=display:none>Back to top</span> <span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style="display: none"><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=http://arie.malam.or.id/2010/11/19/membuat-permalink/"><i class="fa fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&text=Membuat Permalink"><i class="fa fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&title=Membuat Permalink"><i class="fa fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&is_video=false&description=Membuat Permalink"><i class="fa fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Membuat Permalink&body=Check out this article: http://arie.malam.or.id/2010/11/19/membuat-permalink/"><i class="fa fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&title=Membuat Permalink"><i class="fa fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&title=Membuat Permalink"><i class="fa fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&title=Membuat Permalink"><i class="fa fa-stumbleupon" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&title=Membuat Permalink"><i class="fa fa-digg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&name=Membuat Permalink&description=Membuat Permalink"><i class="fa fa-tumblr" aria-hidden=true></i></a></li></ul></div><div id=toc></div></span></div><div class="content index width mx-auto px2 my4"><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Membuat Permalink</h1><div class=meta><span class=author itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name>Arie W. Subagja</span></span><div class=postdate><time datetime=2010-11-18T21:31:00.000Z itemprop=datePublished>2010-11-19</time></div><div class=article-tag><i class="fa fa-tag"></i> <a class=tag-link href=/tags/Database/ >Database</a>, <a class=tag-link href=/tags/PHP/ >PHP</a></div></div></header><div class=content itemprop=articleBody><p>Ahh.. lagi2 <a class="reference external" href=http://en.wikipedia.org/wiki/Permalink target=_blank rel=noopener>permalink</a>, dulu pernah gw bahas beberapa kali diblog ini, cuman karena kejadian kemaren, banyak data yg ga bisa diselamatin, dan yahhh… kebetulan gw ada percobaan baru.</p><p>Masih tetep membuat ‘slug’, untuk permalink ini. caranya gimana biar si slug ini tetep unique. Kita ga boleh pake slug yang sama, harus beda dengn yg laen, tapi kalo ada yg udah pake, kita tambahin belakangnya ‘-2’ atau ‘-3’ dan selanjutnya.</p><pre class=literal-block>
function slug($text)
{
  $text = preg_replace('/[^a-z0-9-\/]/', '-', strtolower($text));
  $text = preg_replace('/-{2,}/', '-', $text);
  $text = trim($text, '-');
  return $text;
}
</pre><p>Misal gini: gw mau bikin postingan dengan judul ‘hello’, maka ntar permalinknya: ‘/post/ <strong>hello</strong>’. si <strong>hello</strong> ini dari <tt class="docutils literal"><span class=pre>slug('hello')</span> </tt>.</p><p>Lalu bikin lagi postingan dengan judul yg tetep sama, slug harus menjadi ‘hello-2’, karena slug ‘hello’ sudah terpakai.</p><p>Nahh yang jadi masalah adalah setiap kita mau bikin slug. kita mesti cek apakah ‘hello’ sudah terpakai atau belum.</p><p>Caranya seperti ini, ketika kita akan menambahkan entry baru dengan title=hello, maka:</p><ol class="arabic simple"><li>bikin slug=slug(hello)</li><li>cek database, apakah slug ‘hello’ sudah terpakai?</li><li>jika sudah, ubah slug menjadi: slug=slug(‘hello $i’), dimana $i merupakan angka jumlah dari slug,misal 2, 3 atau 4. ulangi langkah 2, sampai slug ga ada yg pakai.</li></ol><p>Terlihat sangar sederhana, tapi pada kenyataanya akan memakan resources yg lumayan gede (kalo slug hello sudah mencapai lebih dari ratusan). Karena kita akan selalu search ke database, cek ada atau tidak, lalu mencoba ganti slug, lalu search lagi, hal itu dilakukan sampe hello-x tidak terpakai.</p><p>Nah, tadi gw coba lagi, juga karena kebutuhan, gw test menjadi seperti ini:</p><pre class=literal-block>
function slug($string)
{
  global $adb;

  $query  = sprintf(&quot;SELECT * FROM tags WHERE slug REGEXP '^%s(-[[:digit:]])?'&quot;,
                    $adb-&gt;escape(_slug($string)));

  $result = $adb-&gt;get_results($query);
  $total  = sizeof($result);

  if ($result != null)
  {
    $numbers = array();
    $found   = false;

    foreach ($result as $r)
    {
      if ($r-&gt;slug == _slug($string))
        $found = true;

      if (preg_match('/-(\d+)$/i', $r-&gt;slug, $match))
        $numbers[] = $match[1];
    }

    if (sizeof($numbers) &gt; 0)
      $string = &quot;{$string}-&quot;.(max($numbers) + 1);

    elseif ($found)
      $string = &quot;{$string} 2&quot;;

  }
  return _slug($string);
}
</pre><p><em>$adb ini merupakan instance dari `ezSQL_mysql &lt;http://justinvincent.com/ezsql&gt;`__, dan function _slug, adalah fungsi slug paling atas, lalu gw rename menjadi _slug</em></p><p>Dengan function gw yg baru itu, gw eprtama kali bakal ngecek ke database, entry mana yg ga sama slug dan namanya sama tand (dan slugnya) yg gw bikin mau tambahin. Jika tidak ada, ya pake slug baru.</p><p>Tapi jika ada, cek, apakah ada akhiran <tt class="docutils literal"><span class=pre>-x</span> </tt>pada slug? jika ada. ambil nilai <tt class="docutils literal">x</tt> terbesar, lalu tambah 1. Hasilnya, slug baru itu adalah: <tt class="docutils literal"><span class=pre>SLUG-(x+1)</span> </tt>, dimana <tt class="docutils literal">x</tt> adalah <tt class="docutils literal">0</tt> sampe <tt class="docutils literal">n</tt>.</p><p>Hanya 1 kali cek database, gak perlu berulang-ulang.</p></div></article><div class=blog-post-comments><div id=disqus_thread><noscript>Please enable JavaScript to view the <a href=//disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style="display: none"><ul><li><a href=/ >Home</a></li><li><a href=/archives/ >Blog</a></li><li><a href=/about/ >About</a></li><li><a href=/contact/ >Contact</a></li></ul></div><div id=toc-footer style="display: none"></div><div id=share-footer style="display: none"><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=http://arie.malam.or.id/2010/11/19/membuat-permalink/"><i class="fa fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&text=Membuat Permalink"><i class="fa fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&title=Membuat Permalink"><i class="fa fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&is_video=false&description=Membuat Permalink"><i class="fa fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Membuat Permalink&body=Check out this article: http://arie.malam.or.id/2010/11/19/membuat-permalink/"><i class="fa fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&title=Membuat Permalink"><i class="fa fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&title=Membuat Permalink"><i class="fa fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&title=Membuat Permalink"><i class="fa fa-stumbleupon fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&title=Membuat Permalink"><i class="fa fa-digg fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=http://arie.malam.or.id/2010/11/19/membuat-permalink/&name=Membuat Permalink&description=Membuat Permalink"><i class="fa fa-tumblr fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><ul><li id=toc><a class=icon href=# onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden=true></i> TOC</a></li><li id=share><a class=icon href=# onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden=true></i> Share</a></li><li id=top style=display:none><a class=icon href=# onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></li><li id=menu><a class=icon href=# onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden=true></i> Menu</a></li></ul></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2017 Arie W. Subagja</div><div class=footer-right><nav><ul><li><a href=/ >Home</a></li><li><a href=/archives/ >Blog</a></li><li><a href=/about/ >About</a></li><li><a href=/contact/ >Contact</a></li></ul></nav></div></footer><link rel=stylesheet href=/lib/font-awesome/css/font-awesome.min.css><link rel=stylesheet href=/lib/meslo-LG/styles.css><link rel=stylesheet href=/lib/justified-gallery/justifiedGallery.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/lib/justified-gallery/jquery.justifiedGallery.min.js></script><script src=/js/main.js></script><script>(function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js',
      'ga');
    ga('create', 'UA-20386094-1', 'auto');
    ga('send', 'pageview');</script><script>var disqus_shortname = 'staticamorid';
    (function() {
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName(
        'body')[0]).appendChild(dsq);
    }());</script></body></html>